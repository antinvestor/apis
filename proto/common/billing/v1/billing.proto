// Copyright 2023-2024 Ant Investor Ltd
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package billing.v1;

import "buf/validate/validate.proto";
import "gnostic/openapi/v3/annotations.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "google/type/interval.proto";
import "google/type/money.proto";

option cc_enable_arenas = true;
option go_package = "github.com/antinvestor/apis/go/billing/v1;billingv1";
option java_multiple_files = true;
option java_package = "billingv1";
option (gnostic.openapi.v3.document) = {
  info: {
    title: "Billing Types"
    version: "v1.0.0"
    description: "The Billing Types library provides shared data structures, enumerations, and utility messages used across all Ant Investor API services. This includes standard state and status enums, pagination helpers, search request patterns, and contact linking structures. These types ensure consistency and interoperability across the entire API ecosystem."
    contact: {
      name: "Ant Investor Ltd"
      url: "https://github.com/antinvestor/apis"
      email: "info@antinvestor.com"
    }
    license: {
      name: "Apache License"
      url: "https://github.com/antinvestor/apis/blob/master/LICENSE"
    }
  }
};

message ResourceReference {
  // Resource type, e.g. "compute_instance", "storage_bucket", "api_request".
  string type = 1;

  // Provider-specific or internal resource ID.
  string resource_id = 2 [
    (buf.validate.field).string.min_len = 3,
    (buf.validate.field).string.max_len = 40,
    (buf.validate.field).string.pattern = "[0-9a-z_-]{3,40}"
  ]; // Unique identifier of the entity or operation

  // Owning tenant / account / project.
  string owner_id = 3 [
    (buf.validate.field).string.min_len = 3,
    (buf.validate.field).string.max_len = 40,
    (buf.validate.field).string.pattern = "[0-9a-z_-]{3,40}"
  ]; // Unique identifier of the entity or operation
}

message SpendComponent {
  // Human-readable description, e.g. "CPU hours", "egress bandwidth".
  string description = 1;

  // Quantity consumed (semantic depends on unit).
  double quantity = 2;

  // Unit of measurement, e.g. "hours", "gb", "requests".
  string unit = 3;

  // Cost of this component.
  google.type.Money amount = 4;
}

// Represents monetary spend incurred by a resource over a time interval.
message ResourceSpend {
  // Unique identifier for this spend record (idempotency, reconciliation).
  string spend_id = 1 [
    (buf.validate.field).string.min_len = 3,
    (buf.validate.field).string.max_len = 40,
    (buf.validate.field).string.pattern = "[0-9a-z_-]{3,40}"
  ]; // Unique identifier of the entity or operation

  // Logical or physical resource that incurred the spend.
  ResourceReference resource = 2;

  // Time window during which the spend was accrued.
  google.type.Interval interval = 3;

  // Total monetary amount for the interval.
  google.type.Money amount = 4;

  // Optional breakdown of the spend.
  repeated SpendComponent components = 5;

  // When this spend record was calculated or finalized.
  google.protobuf.Timestamp calculated_at = 6;

  // Arbitrary metadata for tagging, auditing, or attribution.
  google.protobuf.Struct labels = 7;
}
